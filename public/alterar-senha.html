<!doctype html><html lang="pt-BR"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Alterar senha â€” MMA</title>
<script src="/config.js"></script>
<style>
  body{font-family:Inter,system-ui;background:#24100F;color:#f5eee8;margin:0}
  .wrap{min-height:100dvh;display:grid;place-items:center}
  .card{width:min(420px,90vw);background:#2E1513;border-radius:14px;padding:28px}
  label{display:block;margin:12px 0 6px;color:#cdbfb8}
  input{width:100%;padding:12px;border-radius:10px;border:1px solid #3b1f1c;background:#1d0d0c;color:#f5eee8}
  button{margin-top:14px;background:#c9a268;color:#24100F;border:0;padding:12px 16px;border-radius:999px;font-weight:600;cursor:pointer}
  .error{margin-top:10px;color:#ffdede}
</style></head><body>
<div class="wrap"><div class="card">
  <h2>Alterar senha</h2>
  <div class="error" id="err"></div>
  <label>Senha atual</label><input id="curr" type="password"/>
  <label>Nova senha</label><input id="next" type="password"/>
  <button id="ok">Alterar</button>
</div></div>
<script>
let API_BASE = window.API_BASE || '/api';
  while (API_BASE.endsWith('/')) API_BASE = API_BASE.slice(0, -1);
  const apiUrl = window.buildApiUrl || ((path) => `${API_BASE}${path.startsWith('/') ? path : `/${path}`}`);
const token = localStorage.getItem('mma_token');
if(!token){ location.href='/login.html'; }

document.getElementById('ok').onclick = async ()=>{
  const currentPassword = document.getElementById('curr').value;
  const newPassword = document.getElementById('next').value;
  try{
    const r = await fetch(apiUrl('/auth/change-password'),{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
      body: JSON.stringify({ currentPassword, newPassword })
    });
    const data = await r.json();
    if(!r.ok) throw new Error(data.error||'Erro');
    alert('Senha alterada com sucesso!');
    location.href='/';
  }catch(e){ document.getElementById('err').textContent=e.message; }
};
</script>
</body></html>