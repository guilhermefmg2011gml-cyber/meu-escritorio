<!doctype html><html lang="pt-BR"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Primeiro acesso — MMA</title>
<style>
  body{font-family:Inter,system-ui;background:#24100F;color:#f5eee8;margin:0}
  .wrap{min-height:100dvh;display:grid;place-items:center}
  .card{width:min(420px,90vw);background:#2E1513;border-radius:14px;padding:28px}
  label{display:block;margin:12px 0 6px;color:#cdbfb8}
  input{width:100%;padding:12px;border-radius:10px;border:1px solid #3b1f1c;background:#1d0d0c;color:#f5eee8}
  button{margin-top:14px;background:#c9a268;color:#24100F;border:0;padding:12px 16px;border-radius:999px;font-weight:600;cursor:pointer}
  .error{margin-top:10px;color:#ffdede}
</style></head><body>
<div class="wrap"><div class="card">
  <h2>Defina sua nova senha</h2>
  <p style="opacity:.8">Por segurança, altere a senha provisória.</p>
  <div class="error" id="err"></div>
  <label>Nova senha (mín. 8 caracteres)</label>
  <input id="pass" type="password" />
  <button id="ok">Salvar e continuar</button>
</div></div>
<script>
const API_BASE='http://localhost:8080';
const token = localStorage.getItem('mma_token');
if(!token){ location.href='/login.html'; }

document.getElementById('ok').onclick = async ()=>{
  const newPassword = document.getElementById('pass').value;
  try{
    const r = await fetch(`${API_BASE}/api/auth/first-change-password`,{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
      body: JSON.stringify({ newPassword })
    });
    const data = await r.json();
    if(!r.ok) throw new Error(data.error||'Erro ao alterar senha');
    // redireciona
    const user = JSON.parse(localStorage.getItem('mma_user')||'{}');
    if(user.role==='admin') location.href='/admin/create-user.html';
    else location.href='/';
  }catch(e){
    const err = document.getElementById('err');
    err.textContent = e.message;
  }
};
</script>
</body></html>